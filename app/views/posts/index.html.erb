<%= provide(:title, 'Posts Feed') %>

<h2 class="text-center m-5">Post Feed</h2>
<hr>
  <% @posts.each do |p| %>
  <ul class="posts-container">
    <li> <%= gravatar_for p.user, size: 30 %> <small><%= get_user(p) %></small></li>
    <li><%= link_to 'View Post', post_path(p.id) %></li>
    <li>Title: <%= p.title %></li>
    <li>Content: <%= p.content %></li>
    <span class="bg-primary published badge badge-pill float-elem"> Published <%= time_ago_in_words(p.created_at) %> ago. </span>

    <button type="button" class="btn btn-primary">
      <%= link_to "#{pluralize(p.likes.count, 'like')} <i class='far fa-thumbs-up'></i>".html_safe, likes_path( likeable_data(p)), method: :post, class: "badge badge-light" %>
      <% if liked?(p) %>
      <%= link_to "Unlike <i class='far fa-thumbs-down'></i>".html_safe, like_path( like_id(p) ), method: :delete, class: "badge badge-light" %>
      <% end %>
    </button> 
      <button type="button" class="index-comment-btn btn btn-primary">Add comment <%= fa_icon "comment" %> </button> <br>
      <span class="badge badge-pill badge-info"><%= pluralize(p.comments.count, "comment") %></span>
      <div class="index-comment-form animated fadeInDown">
        <%= form_for @comment do |f| %>
        <%= render 'shared/error_messages', object: f.object %>
        <%= f.label :content %>
        <%= f.text_area :content, autofocus: true, class: 'form-control' %>
        <%= f.hidden_field :post_id, value: p.id %>
        <%= f.submit "Comment", class: "btn btn-success comment-btn"%>
        <% end %>
      </div>
    <% if owner?(p.user) %>
    <div class="wrap-controls">
      <%= fa_icon "ellipsis-h" %> <br>
      <span class="controls">
        <p><%= link_to 'Edit', edit_post_path(p) %></p>
        <p>
          <%= link_to 'Delete',  post_path(p), method: :delete, data: { confirm: 'Are you certain you want to delete this?' } %>
        </p>
      </span>
    </div>
  <% end %>
  </ul>
  <hr>
  <% end %>
</div>

<%= javascript_pack_tag 'custom' %>
